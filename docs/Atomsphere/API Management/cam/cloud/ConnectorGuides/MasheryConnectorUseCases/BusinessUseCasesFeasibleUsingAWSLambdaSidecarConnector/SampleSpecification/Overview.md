---
sidebar_position: 1
---

# Overview of Sample Specifications and API Management Gateway Action

<head>
  <meta name="guidename" content="API Management"/>
  <meta name="context" content="GUID-51f1b6cf-d63f-4f6c-85c5-d11b84976fa8"/>
</head>

Following table provides sample high level specs between API Management Gateway and AWS Lambda function implementation. Based on agreed integration specs API Management Gateway takes appropriate action. 

|**Condition** |**Applicability** |**Connector Pre/Post Input Configuration Data** |**Connector Constructed JSON Object to Lambda Function** |**AWS Lambda Function Response Code** |**AWS Lambda Function Output** |**Gateway Action** |
| ----- | --- | ----- | ---- | ----- | ---- | ---- |
|<p>Valid request: </p><p>Input Scenario -Synchronicity specified as "request-response" </p><p>Output Scenario- Empty response from AWS Lambda </p>|Pre Post |<p>- Synchronicity:request-response </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|<p>\{ </p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af", "point" : "PreProcessor/PostProcessor", "synchronicity" : "RequestResponse", "packageKey" : "kxm48rvx9anypbcfq5fyjw5s", "serviceId" : "eq7mxju5k4hvmpzejpzax2ap", "endpointId" : "8xbkgw5q387cs9juushwwrtv", \}</p>|200 |\{\} |Forward client request to target server in case of pre-process. Forward response to user client in case of post-process. |
|<p>Valid request: </p><p>Input Scenario -Synchronicity not specified </p><p>Output Scenario - Getting only code in terminate object from AWS Lambda </p>|Pre Post |<p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|<p>\{ </p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af", "point" : "PreProcessor/PostProcessor", "synchronicity" : "RequestResponse", "packageKey" : "kxm48rvx9anypbcfq5fyjw5s", "serviceId" : "eq7mxju5k4hvmpzejpzax2ap", "endpointId" : "8xbkgw5q387cs9juushwwrtv",\}</p>|200 |<p>\{</p><p>"terminate" : \{</p><p>"code" : 403</p><p>\}\}</p>|<p>Block the call and return call to user client. Send error code 403 to the user client with the message </p><p>Service cannot be provided, code 0x000003BB</p>|
|<p>Valid request: </p><p>Input Scenario -Incorrect Synchronicity specified  </p><p>Output Scenario - Getting code and message in terminate object from AWS </p>|Pre Post |<p>- synchronicity:event </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|<p>\{ </p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af", "point" : "PreProcessor/PostProcessor", "synchronicity" : "RequestResponse", "packageKey" : "kxm48rvx9anypbcfq5fyjw5s", "serviceId" : "eq7mxju5k4hvmpzejpzax2ap", "endpointId" : "8xbkgw5q387cs9juushwwrtv",</p><p></p><p>\}</p>|200 |<p>\{</p><p>"terminate" : \{</p><p>"code" : 400,</p><p>"message" : "Bad Request"   </p><p>\}</p><p>\}</p>|<p>Block the call and return call to user client. Send error code 400 to the user client with the message </p><p>Bad Request.</p>|
|<p>Valid request: </p><p>Input Scenario - Synchronicity specified as "event" </p>|Pre Post |<p>- synchronicity:event </p><p>- functionARN:arn:aws:lambda:eu-west-1:12345678:function:LambdaBasicAsync </p><p>- useAssumeRole:false </p><p>- region:eu-west-1 </p>|<p>\{</p><p>"point":"PreProcessor/PostProcessor","masheryMessageId":"c3949ec1-b980-4ee1-b3c5-ce1599435950","serviceId":"9yt9cgmu74rypb8stg5r67hh","packageKey":"b8664brqffa5zbe47hg6p2b3","endpointId":"4xk6dfdx95x7ycj77eeyj6ta","synchronicity":"Event"\}</p>|200 |\{\} |Forward client request to target server in case of pre-process. Forward response to user client in case of post-process. |
|<p>Valid request: </p><p>Input Scenario - Skip Request Header specified and all required headers present in request </p><p>Output Scenario - Getting addHeader, payload in modify object from AWS </p>|Pre Post |<p>- synchronicity:request-response </p><p>- require-request-headers: Authorization </p><p>- include-request-headers: Header1, Header2 </p><p>- skip-request-headers : Header1, Authorization </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|<p>\{ </p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af", "point" : "PreProcessor/PostProcessor", "synchronicity" : "RequestResponse", "packageKey" : "kxm48rvx9anypbcfq5fyjw5s", "serviceId" : "eq7mxju5k4hvmpzejpzax2ap", "endpointId" : "8xbkgw5q387cs9juushwwrtv",</p><p></p><p>"request": \{ "headers": \{ "Header2": "Header2\_Value"</p><p></p><p>\}</p><p></p><p>`      `\}</p><p></p><p>\}</p>|200 |<p>\{</p><p>"modify" : \{</p><p>"payload" : "Custom Payload",</p><p>"addHeaders" : \{</p><p>`      `"x-acme-error" : "B0-932-K"</p><p>\}</p><p>\}</p>|Forward the request to target server in case of pre-process and set payload as Custom Payload and add header x-acme-error in the target requestForward the response to user client in case of post-process and set payload as Custom Payload and add header x-acme-error in the response. |
|<p>Valid request: </p><p>Input Scenario - Include Response Header specified and not present in response </p><p>Output Scenario - Getting Getting dropHeader, json in modify object from AWS </p>|Post |<p>- include-response-headers: Header1 </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|<p>\{ </p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af", "point" : "PostProcessor", "synchronicity" : "RequestResponse", "packageKey" : "kxm48rvx9anypbcfq5fyjw5s", "serviceId" : "eq7mxju5k4hvmpzejpzax2ap", "endpointId" : "8xbkgw5q387cs9juushwwrtv"</p><p></p><p>\}</p>|200 |<p>\{</p><p>"modify" : \{</p><p>"base64Encoded" : true,</p><p>"completeWithCode" : 500,</p><p>` `"json" : \{</p><p>`      `"a" : "b",</p><p>`      `"c" : "d"</p><p>\},</p><p>"dropHeaders" :[ "authorization" ] \}\}</p>|<p>Forward the response to user client and set payload as below value: </p><p>\{</p><p>"a" : "b"</p><p>"c" : "d"</p><p>\}</p><p>Add drop header authorization from response and set response code as 500.</p>|
|<p>Valid request: </p><p>Input Scenario - Skip Response Header specified and all required headers present in response </p><p>Output Scenario - Getting base64 encoded payload in modify object from AWS </p>|Post |<p>- synchronicity:request-response </p><p>- include-response-headers: Header1,Header2 </p><p>- skip-request-headers : Header1 </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|<p>\{ </p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af", "point" : "PostProcessor", "synchronicity" : "RequestResponse", "packageKey" : "kxm48rvx9anypbcfq5fyjw5s", "serviceId" : "eq7mxju5k4hvmpzejpzax2ap", "endpointId" : "8xbkgw5q387cs9juushwwrtv",</p><p></p><p>"response": \{ "headers": \{ "Header2": "Header2\_Value"</p><p></p><p>\}</p><p></p><p>\}</p><p></p><p>\}</p>|200 |<p>\{</p><p>"modify" : \{</p><p>"completeWithCode" : 201,</p><p>"payload" : "Q3VzdG9tIHBheWxvYWQ="</p><p>"base64Encoded" : true</p><p>\}</p><p>\}</p>|Forward the response to user client and set payload as Custom Payload and set response code as 201. |
|Require EAV/Require Package Key EAVs Not Present |Pre Post |<p>- synchronicity:request-response </p><p>- require-eavs: ApplicationEAV1 </p><p>- require-packageKey-eavs: PackageKeyEAV1 </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|NA |NA |NA |Block the call and return call to user client. Send error code 400 to the user client with the message RequiredApplicationEAVConditionFailure.|
|AmazonServiceException like Invalid AWS Credentials with failSafeParameter as True |Pre Post |<p>- synchronicity:event </p><p>- failSafe:true </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|<p>\{</p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af",</p><p>"point" : "PreProcessor",</p><p>"synchronicity" : "RequestResponse",</p><p>"packageKey" : "kxm48rvx9anypbcfq5fyjw5s",</p><p>"serviceId" : "eq7mxju5k4hvmpzejpzax2ap",</p><p>"endpointId" : "8xbkgw5q387cs9juushwwrtv"</p><p>\}</p>|403Error Message : Unauthorized User |NA |Forward client request to origin server. |
|<p>Valid request: </p><p>Input Scenario - Request payload is smaller than maxPayloadSize but greater than 10KB and request payload is json </p><p>Output Scenario - Same Header is specified in dropHeader and addHeaders and completWithCode in modify object from AWS </p>|Pre |<p>- synchronicity:request-response/event </p><p>- expand-input : requestPayload </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p><p>- max-payload-size: 20 </p>|<p>\{</p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af",</p><p>"point" : "PreProcessor",</p><p>"synchronicity" : "RequestResponse",</p><p>"packageKey" : "kxm48rvx9anypbcfq5fyjw5s",</p><p>"serviceId" : "eq7mxju5k4hvmpzejpzax2ap",</p><p>"endpointId" : "8xbkgw5q387cs9juushwwrtv",</p><p>` `"request" : \{</p><p>"payloadLength" : 95,</p><p>"payload" : "\{"stay": \{"checkIn": "2016-08-15","checkOut": "2016-08-20","shiftDays": "2"\},"dailyRate": true\}",</p><p>"payloadBase64Encoded" : false</p><p>\}</p><p>\}</p>|200 |<p>\{</p><p>"modify" : \{</p><p>"payload" : "Set replacement payload",</p><p>"base64Encoded" : false,</p><p>"addHeaders" : \{</p><p>`      `"x-acme-level" : "44",</p><p>`      `"x-acme-bearing" : "326 degrees of inner turbulence"</p><p>\},</p><p>"dropHeaders" : [ "x-acme-level" ],</p><p>"completeWithCode": 201</p><p>\}</p><p>\} </p>|Send the request to the target server with payload as Set replacement payload and headers x-acme-level and x-acme-bearing added in the request. In case of pre-process, completeWithCode will not be set in the response. |
|<p>Valid request: </p><p>Input Scenario -Max Payload Condition specified but not expand-input and response payload is greater than max payload size </p><p>Output Scenario - Exception from AWS </p>|Post |<p>- synchronicity:request-response </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p><p>- max-payload-size: 20 </p><p>- max-payload-condition: Blocking </p><p>- expand-input : responsePayload </p>|<p>\{</p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af",</p><p>"point" : "PostProcessor",</p><p>"synchronicity" : "RequestResponse",</p><p>"packageKey" : "kxm48rvx9anypbcfq5fyjw5s",</p><p>"serviceId" : "eq7mxju5k4hvmpzejpzax2ap",</p><p>"endpointId" : "8xbkgw5q387cs9juushwwrtv",</p><p>` `"response" : \{</p><p>"payloadLength" : 95,</p><p>"payload" : "\{"stay": \{"checkIn": "2016-08-15","checkOut": "2016-08-20","shiftDays": "2"\},"dailyRate": true\}",</p><p>"payloadBase64Encoded" : false</p><p>\}\}</p>|NA |NA |<p>Block the call and return call to user client .Send error code 500 to the user client with the message </p><p>InvalidResponseFromAWSLambdaInPostProcess(/h1)</p>|
|<p>Valid request: </p><p>Input Scenario -Response payload is greater than max payload size and max payload condition is filtering </p><p>Output Scenario - Exception from AWS and failSafe is true in input configuration </p>|Post |<p>- synchronicity:request-response </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p><p>- max-payload-size: 20 </p><p>- max-payload-condition: Filtering </p><p>- expand-input : responsePayload </p>|<p>\{</p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af",</p><p>"point" : "PostProcessor",</p><p>"synchronicity" : "RequestResponse",</p><p>"packageKey" : "kxm48rvx9anypbcfq5fyjw5s",</p><p>"serviceId" : "eq7mxju5k4hvmpzejpzax2ap",</p><p>"endpointId" : "8xbkgw5q387cs9juushwwrtv",</p><p>` `"response" : \{</p><p>"payloadLength" : 35678,</p><p>"payload" : "\{"stay": \{"checkIn": "2016-08-15","checkOut": "2016-08-20","shiftDays": "2"\},"dailyRate": true\}",</p><p>"payloadBase64Encoded" : false</p><p>\}</p><p>\}</p>|NA |NA |Forward the call to the target server as failSafe parameter is true. |
|<p>Valid request: </p><p>Input Scenario - ResponsePayload Content-type is not json and responsePayload is less than 10KB </p><p>Output Scenario - Amazon Service Exception with status code and message and failSafe as True in input configuration </p>|Pre |<p>- synchronicity:request-response </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p><p>- expand-input : responsePayload </p><p>- failSafe: true </p>|<p>\{</p><p>"masheryMessageId" : "7632924a-8d8d-4d35-8a77-b57c4bb450af",</p><p>"point" : "PostProcessor",</p><p>"synchronicity" : "RequestResponse",</p><p>"packageKey" : "kxm48rvx9anypbcfq5fyjw5s",</p><p>"serviceId" : "eq7mxju5k4hvmpzejpzax2ap",</p><p>"endpointId" : "8xbkgw5q387cs9juushwwrtv",</p><p>` `"request" : \{</p><p>"payloadLength" : 95,</p><p>"payload" : "\{"stay": \{"checkIn": "2016-08-15","checkOut": "2016-08-20","shiftDays": "2"\},"dailyRate": true\}",</p><p>"payloadBase64Encoded" : false</p><p>\}</p><p>\}</p>|<p>500 </p><p>Error Message : Invalid AWS Function </p>|NA |Forward the call to the target server as failSafe parameter is true. |
|<p>Valid request: </p><p>Input Scenario - One of the compulsory parameter (fucntionARN/region/roleArn/externalID) is not specified </p>|Pre Post |<p>- synchronicity:request-response </p><p>- functionARN: arn:aws:lambda:us-east-1:12345678:function:orderapi-analytics-sidecar </p><p>- roleARN:arn:aws:sts::12345678:role/tibco\_sidecar\_connector </p><p>- region:us-east-1 </p>|NA |NA |NA |Block the call and return call to user client. Send error code 500 to the user client with the message InvalidPreInputConfiguration.|

AWS Lambda Sidecar Architecture & Design Guidelines Sidecar Connector Assumed Role Support Lambda Function Input (JSON Specs) For Sidecar Preprocess POST Request Call Lambda Function Input (JSON Specs) For Sidecar Postprocess POST Request Call 
